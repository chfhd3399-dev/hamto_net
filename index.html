<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=0,maximum-scale=1.0" >
    <title>hamto.net</title>
    <link rel="stylesheet" href="css/main.css">
    <!--script-->
    <script src="js/jquery-3.3.1.min.js"></script>
    <script src="js/script_main.js"></script>
    <script src="js/scrolla.jquery.min.js"></script>
    <script src="js/splitting.min.js"></script>
    
</head>
<body>
  <div class="wrap">
      <!--header-->
      <!-- <header>
          <div class="inner">
              <a href="#" class="gnbBtn"><span class="a"></span><span class="b"></span></a>
              <a href="#" class="logo">Crew a la mode</a>
              <a href="#" class="contact">contact</a>
          </div>
          <nav class="gnb">
              <ul>
                  <li><a href="#">CREW <span>Made</span></a></li>
                  <li><a href="#">CREW <span>Ready</span></a></li>
                  <li><a href="#">CREW <span>Design</span></a></li>
                  <li><a href="#">CREW <span>Source</span></a></li>
              </ul>
          </nav>
      </header> -->
     <!--contents-->
    

     <div class="contents">
         <section class="visual">
          <div id="visitor-counter">
  <h3>Visit</h3>
  <div class="vc-row">
    <div>
      <div class="vc-label">Total</div>
      <div id="total-visits" class="vc-value">--</div>
    </div>
    <div>
      <div class="vc-label">Visit (Today)</div>
      <div id="local-visits" class="vc-value">--</div>
    </div>
  </div>
  <div id="vc-msg" class="vc-msg"></div>
         </div>
            <img class="ham" src="img/ham4.png" alt="해므스터">
            <h2 class="title animate" data-animate="motion" data-splitting>Coming soon..</h2>
         </section>
       
     </div>  
     <!--footer-->
         <!-- <footer>
             <div class="inner">
                 <h1 class="footerLogo">à</h1>
                 <ul class="contact">
                     <li>Carrer del Jardi Botànic 4, Palma De Mallorca, 07012</li>
                     <li>+34 123 456 789 | abcd.com</li>
                 </ul>
                 <ul class="sns">
                     <li><a href="#">INSTAGRAM</a></li>
                     <li><a href="#">FACEBOOK</a></li>
                     <li><a href="#">LINKEDIN</a></li>
                 </ul>
             </div>
         </footer> -->
  </div>  
</body>

<script>
  (function() {
    const NAMESPACE = 'hamto-net';
    const KEY = 'homepage';
    const API_BASE = 'https://api.countapi.xyz';  // 반드시 https:// 사용
    const API_HIT = `${API_BASE}/hit/${encodeURIComponent(NAMESPACE)}/${encodeURIComponent(KEY)}`;
    const API_GET = `${API_BASE}/get/${encodeURIComponent(NAMESPACE)}/${encodeURIComponent(KEY)}`;

    const totalEl = document.getElementById('total-visits');
    const localEl = document.getElementById('local-visits');
    const msgEl = document.getElementById('vc-msg');
    const LOCAL_KEY = 'hamto_local_visits_homepage';

    function increaseLocal() {
      try {
        const prev = parseInt(localStorage.getItem(LOCAL_KEY) || '0', 10);
        const next = prev + 1;
        localStorage.setItem(LOCAL_KEY, String(next));
        localEl.textContent = next;
      } catch (e) {
        localEl.textContent = 'N/A';
      }
    }

    async function hitAndShowTotal() {
      try {
        const res = await fetch(API_HIT, { method: 'GET', cache: 'no-store', mode: 'cors' });
        if (!res.ok) throw new Error('CountAPI hit 실패');
        const data = await res.json();
        if (data.value !== undefined) {
          totalEl.textContent = data.value;
          msgEl.textContent = '실시간 총 방문수입니다.';
        } else {
          getTotalFallback();
        }
      } catch (err) {
        console.warn('CountAPI hit 오류:', err);
        msgEl.textContent = '총 방문수를 불러오는 중 오류가 발생했습니다.';
        getTotalFallback();
      }
    }

    async function getTotalFallback() {
      try {
        const res = await fetch(API_GET, { method: 'GET', cache: 'no-store', mode: 'cors' });
        if (!res.ok) throw new Error('CountAPI get 실패');
        const data = await res.json();
        totalEl.textContent = data.value ?? 'N/A';
      } catch (e) {
        console.warn('CountAPI get 오류:', e);
        totalEl.textContent = 'N/A';
      }
    }

    increaseLocal();
    hitAndShowTotal();
  })();
</script>

</html>